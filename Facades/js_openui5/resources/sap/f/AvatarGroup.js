/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./library","sap/ui/core/Control","sap/ui/core/delegate/ItemNavigation","sap/ui/dom/units/Rem","./AvatarGroupRenderer","sap/m/Button","sap/m/library","sap/ui/core/ResizeHandler","sap/ui/events/KeyCodes"],function(l,C,I,R,A,B,L,a,K){"use strict";var b=l.AvatarGroupType;var c=L.AvatarColor;var d=L.AvatarSize;var e={XS:2,S:3,M:4,L:5,XL:7};var f={XS:0.75,S:1.25,M:1.625,L:2,XL:2.75};var g={XS:0.0625,S:0.125,M:0.125,L:0.125,XL:0.25};var h=C.extend("sap.f.AvatarGroup",{metadata:{library:"sap.f",properties:{groupType:{type:"sap.f.AvatarGroupType",group:"Appearance",defaultValue:b.Group},avatarDisplaySize:{type:"sap.m.AvatarSize",group:"Appearance",defaultValue:d.S}},defaultAggregation:"items",aggregations:{items:{type:'sap.f.AvatarGroupItem',multiple:true}},events:{press:{parameters:{groupType:{type:"string"},overflowButtonPressed:{type:"boolean"},avatarsDisplayed:{type:"int"}}}}}});h.prototype.init=function(){this._oShowMoreButton=new B({});this._oShowMoreButton.addStyleClass("sapFAvatarGroupMoreButton");this._bFirstRendering=true;this._onResizeRef=this._onResize.bind(this);this._iCurrentAvatarColorNumber=1;this._bShowMoreButton=false;};h.prototype.exit=function(){this._detachResizeHandlers();if(this._oItemNavigation){this.removeEventDelegate(this._oItemNavigation);this._oItemNavigation.destroy();this._oItemNavigation=null;}this._oShowMoreButton.destroy();this._oShowMoreButton=null;};h.prototype.onBeforeRendering=function(){if(this._bFirstRendering){this._iAvatarsToShow=this.getItems().length;this._bFirstRendering=false;}};h.prototype.onAfterRendering=function(){var D,i=[];if(!this._oItemNavigation){this._oItemNavigation=new I(null,null);this._oItemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"]});this.addEventDelegate(this._oItemNavigation);}D=this.getDomRef();this._oItemNavigation.setRootDomRef(D);if(this.getGroupType()===b.Individual){this.getItems().forEach(function(o){i.push(o.getDomRef());});this._oItemNavigation.setItemDomRefs(i);}this._detachResizeHandlers();this._attachResizeHandlers();this._onResize();if(this._shouldShowMoreButton()){this._oShowMoreButton.$().attr("role","button");if(this.getGroupType()===b.Group){this._oShowMoreButton.$().attr("tabindex","-1");}else{this._oShowMoreButton.$().attr("aria-label",this._getResourceBundle().getText("AVATARGROUP_POPUP"));}}this._updateAccState();};h.prototype._getResourceBundle=function(){return sap.ui.getCore().getLibraryResourceBundle("sap.f");};h.prototype._updateAccState=function(){var r=this._getResourceBundle(),s=r.getText("AVATARGROUP_NUMBER_OF_AVATARS",[this._iAvatarsToShow,(this.getItems().length-this._iAvatarsToShow)]),p=r.getText("AVATARGROUP_POPUP");if(this.getGroupType()===b.Group){this.$().attr("aria-label",p+" "+s);}};h.prototype._attachResizeHandlers=function(){this._iResizeHandlerId=a.register(this,this._onResizeRef);};h.prototype._detachResizeHandlers=function(){if(this._iResizeHandlerId){a.deregister(this._iResizeHandlerId);this._iResizeHandlerId=null;}};h.prototype.setGroupType=function(v){this.getItems().forEach(function(i){i._setGroupType(v);});return this.setProperty("groupType",v);};h.prototype.addItem=function(i){i._setDisplaySize(this.getAvatarDisplaySize());i._setAvatarColor(c["Accent"+this._iCurrentAvatarColorNumber]);i._setGroupType(this.getGroupType());this._iAvatarsToShow=this.getItems().length;this._iCurrentAvatarColorNumber++;if(this._iCurrentAvatarColorNumber>10){this._iCurrentAvatarColorNumber=1;}return this.addAggregation("items",i);};h.prototype.setAvatarDisplaySize=function(v){var o=this.getAvatarDisplaySize();this._oShowMoreButton.removeStyleClass("sapFAvatarGroupMoreButton"+o);this._oShowMoreButton.addStyleClass("sapFAvatarGroupMoreButton"+v);if(o===v){return this;}this.getItems().forEach(function(i){i._setDisplaySize(v);});return this.setProperty("avatarDisplaySize",v);};h.prototype.ontap=function(E){var o=E.srcControl;this.firePress({groupType:this.getGroupType(),eventSource:o,overflowButtonPressed:o===this._oShowMoreButton,avatarsDisplayed:this._iAvatarsToShow});};h.prototype.onsapspace=function(E){this.ontap(E);};h.prototype.onsapenter=function(E){this.ontap(E);};h.prototype.onkeyup=function(E){if(E.shiftKey&&E.keyCode==K.ENTER||E.shiftKey&&E.keyCode==K.SPACE){E.preventDefault();}};h.prototype._getAvatarMargin=function(s){var G=this.getGroupType();if(G===b.Group){return f[s];}else{return g[s];}};h.prototype._getAvatarNetWidth=function(i,j){var G=this.getGroupType();if(G===b.Group){return i-j;}else{return i+j;}};h.prototype._getAvatarsToShow=function(w,i,j){var r=R.toPx(1),k=w-(i*r),m=Math.floor(k/(j*r));return m+1;};h.prototype._adjustAvatarsToShow=function(i){if(i-this._iAvatarsToShow>99){this._iAvatarsToShow-=2;}else{this._iAvatarsToShow--;}};h.prototype._getWidth=function(){return this.$().width();};h.prototype._onResize=function(){var w=this._getWidth(),i=this.getItems(),j=i.length,s=this.getAvatarDisplaySize(),k=e[s],m=this._getAvatarMargin(s),n=this._getAvatarNetWidth(k,m),r=this.$().children(".sapFAvatarGroupItem").length;this._iAvatarsToShow=this._getAvatarsToShow(w,k,n);if(j>this._iAvatarsToShow&&j>0){this._bShowMoreButton=true;this._bAutoWidth=false;this._adjustAvatarsToShow(j);if(r!=this._iAvatarsToShow){this._oShowMoreButton.setText("+"+(j-this._iAvatarsToShow));this.invalidate();}}else{this._bAutoWidth=true;this.getDomRef().style.width="auto";if(this._bShowMoreButton){this._bShowMoreButton=false;this.invalidate();}}};h.prototype._shouldShowMoreButton=function(){return this._bShowMoreButton;};return h;});
