/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./TableExtension","./utils/TableUtils","sap/ui/Device","./library","sap/ui/performance/trace/Interaction","sap/base/Log","sap/ui/thirdparty/jquery"],function(T,c,D,l,I,L,q){"use strict";var S=l.SharedDomRef;var M=1000000;var V=2;var d={HORIZONAL:"HORIZONTAL",VERTICAL:"VERTICAL",BOTH:"BOTH"};function e(s,t){L.debug("sap.ui.table.TableScrollExtension",s,t);}function f(a){return typeof a.isConnected==="boolean"&&a.isConnected||document.body.contains(a);}function P(a,p){var r=true;var C=false;var b=[];var s={cancel:function(){if(this.isCancelled()||!this.isRunning()){return;}C=true;for(var i=0;i<b.length;i++){b[i]();}e("Process was cancelled: "+p.id);},isCancelled:function(){return C;},addCancelListener:function(i){b.push(i);},isRunning:function(){return r;},getInfo:function(){return p;}};var t;if(typeof a==="function"){t=new Promise(function(){a.apply(this,Array.prototype.slice.call(arguments).concat(s));});}else{t=Promise.resolve();}Object.assign(t,s);t.then(function(){if(!s.isCancelled()){e("Process has finished: "+p.id);}r=false;});e("Process started: "+p.id);return t;}function g(){this.iIndex=0;this.nOffset=0;this.sOffsetType=g.OffsetType.Pixel;this.bIsInitial=true;}g.OffsetType={Pixel:"Pixel",Percentage:"Percentage",PercentageOfBuffer:"PercentageOfBuffer"};g.prototype.getIndex=function(){return this.iIndex;};g.prototype.getOffset=function(){return this.nOffset;};g.prototype.getOffsetType=function(){return this.sOffsetType;};g.prototype.isOffsetInPixel=function(){return this.sOffsetType===g.OffsetType.Pixel;};g.prototype.isInitial=function(){return this.bIsInitial;};g.prototype.setPosition=function(i,a,O){e("ScrollPosition#setPosition(index: "+i+", offset: "+a+", offsetType: "+O+")");if(!g._isPositiveNumber(i)){return;}if(!g._isPositiveNumber(a)){this.nOffset=0;}this.setIndex(i);this.setOffset(a,O);};g.prototype.setIndex=function(i){e("ScrollPosition#setIndex(index: "+i+")");if(!g._isPositiveNumber(i)){return;}this.bIsInitial=false;this.iIndex=i;};g.prototype.setOffset=function(a,O){e("ScrollPosition#setOffset(offset: "+a+", offsetType: "+O+")");if(!g._isPositiveNumber(a)){return;}this.bIsInitial=false;this.sOffsetType=O in g.OffsetType?O:g.OffsetType.Pixel;if(this.isOffsetInPixel()){this.nOffset=Math.round(a);}else{this.nOffset=Math.min(a,1);}};g.prototype.scrollRows=function(r){var N=this.getIndex()+r;var i=this.getOffset();if(!this.isOffsetInPixel()||N<0){i=0;}this.setPosition(Math.max(0,N),i);};g._isPositiveNumber=function(a){return typeof a==="number"&&!isNaN(a)&&a>=0;};var h=new window.WeakMap();var j=function(t){if(!t){return{};}if(!h.has(t)){h.set(t,{oHorizontalScrollbar:null,iHorizontalScrollPosition:null,oVerticalScrollbar:null,oVerticalScrollPosition:new g(t),bIsScrolledVerticallyByWheel:false,bIsScrolledVerticallyByKeyboard:false,pVerticalScrollUpdateProcess:null,oExternalVerticalScrollbar:null,bIsVerticalScrollbarExternal:false,mTouchSessionData:null,aOnRowsUpdatedPreprocessors:[]});}return h.get(t);};j.destroy=function(t){delete h.delete(t);};var k={UpdateFromFirstVisibleRow:{id:"UpdateFromFirstVisibleRow",rank:6},UpdateFromScrollPosition:{id:"UpdateFromScrollPosition",rank:5},RestoreScrollPosition:{id:"RestoreScrollPosition",rank:4},AdjustToTotalRowCount:{id:"AdjustToTotalRowCount",rank:3},OnRowsUpdated:{id:"OnRowsUpdated",rank:3},UpdateFromScrollbar:{id:"UpdateFromScrollbar",rank:2},UpdateFromViewport:{id:"UpdateFromViewport",rank:1},canStart:function(t,p){var a=j(t).pVerticalScrollUpdateProcess;var C=a?a.getInfo():null;if(a&&a.isRunning()&&C.rank>p.rank){e("Cannot start update process "+p.id+" - A higher-ranked update process is currently running ("+C.id+")",t);return false;}return true;},start:function(t,p,a){if(!k.canStart(t,p)){return null;}if(j(t).pVerticalScrollUpdateProcess){j(t).pVerticalScrollUpdateProcess.cancel();}j(t).pVerticalScrollUpdateProcess=new P(a,p);return j(t).pVerticalScrollUpdateProcess;}};var H={onScrollbarScroll:function(a){var N=a.target.scrollLeft;var O=a.target._scrollLeft;I.notifyScrollEvent&&I.notifyScrollEvent(a);if(N!==O){var s=H.getScrollAreas(this);a.target._scrollLeft=N;for(var i=0;i<s.length;i++){var b=s[i];if(b!==a.target&&b.scrollLeft!==N){b.scrollLeft=N;b._scrollLeft=N;}}j(this).iHorizontalScrollPosition=N;}},restoreScrollPosition:function(t){var s=t._getScrollExtension();var a=s.getHorizontalScrollbar();if(a&&j(t).iHorizontalScrollPosition!==null){var b=H.getScrollAreas(t);for(var i=0;i<b.length;i++){var p=b[i];delete p._scrollLeft;}if(a.scrollLeft!==j(t).iHorizontalScrollPosition){a.scrollLeft=j(t).iHorizontalScrollPosition;}else{var r=q.Event("scroll");r.target=a;H.onScrollbarScroll.call(t,r);}}},onScrollbarMouseDown:function(a){this._getKeyboardExtension().setActionMode(false);},addEventListeners:function(t){var s=t._getScrollExtension();var a=s.getHorizontalScrollbar();var b=H.getScrollAreas(t);if(!s._onHorizontalScrollEventHandler){s._onHorizontalScrollEventHandler=H.onScrollbarScroll.bind(t);}for(var i=0;i<b.length;i++){b[i].addEventListener("scroll",s._onHorizontalScrollEventHandler);}if(a){if(!s._onHorizontalScrollbarMouseDownEventHandler){s._onHorizontalScrollbarMouseDownEventHandler=H.onScrollbarMouseDown.bind(t);}a.addEventListener("mousedown",s._onHorizontalScrollbarMouseDownEventHandler);}},removeEventListeners:function(t){var s=t._getScrollExtension();var a=s.getHorizontalScrollbar();var b=H.getScrollAreas(t);if(s._onHorizontalScrollEventHandler){for(var i=0;i<b.length;i++){b[i].removeEventListener("scroll",s._onHorizontalScrollEventHandler);delete b[i]._scrollLeft;}delete s._onHorizontalScrollEventHandler;}if(a&&s._onHorizontalScrollbarMouseDownEventHandler){a.removeEventListener("mousedown",s._onHorizontalScrollbarMouseDownEventHandler);delete s._onHorizontalScrollbarMouseDownEventHandler;}},getScrollAreas:function(t){var a=t.getDomRef();var s;if(a){s=Array.prototype.slice.call(t.getDomRef().querySelectorAll(".sapUiTableCtrlScr"));}var b=[t._getScrollExtension().getHorizontalScrollbar()].concat(s);return b.filter(function(i){return i!=null;});}};var m={performUpdateFromFirstVisibleRow:function(t,b){e("VerticalScrollingHelper.performUpdateFromFirstVisibleRow",t);k.start(t,k.UpdateFromFirstVisibleRow,function(r,a,p){if(b===true){var O=function(){e("VerticalScrollingHelper.performUpdateFromFirstVisibleRow (async: rows update)",t);m._performUpdateFromFirstVisibleRow(t,p).then(r);return false;};m.addOnRowsUpdatedPreprocessor(t,O);p.addCancelListener(function(){var R=m.removeOnRowsUpdatedPreprocessor(t,O);if(R){r();}});}else{m._performUpdateFromFirstVisibleRow(t,p).then(r);}});},_performUpdateFromFirstVisibleRow:function(t,p){return m.adjustScrollPositionToFirstVisibleRow(t,p).then(function(){if(m.isIndexInBuffer(t,t.getFirstVisibleRow())){return m.adjustFirstVisibleRowToScrollPositionInBuffer(t,p);}return Promise.resolve();}).then(function(){return Promise.all([m.scrollViewport(t,p),m.scrollScrollbar(t,p)]);});},performUpdateFromScrollPosition:function(t){e("VerticalScrollingHelper.performUpdateFromScrollPosition",t);k.start(t,k.UpdateFromScrollPosition,function(r,a,p){m.adjustFirstVisibleRowToScrollPosition(t,null,p).then(function(){if(p.isCancelled()){return;}var s=j(t).oVerticalScrollPosition;e("VerticalScrollingHelper.performUpdateFromScrollPosition (async: firstVisibleRow update)",t);if(s.getIndex()>t.getFirstVisibleRow()){s.setIndex(t.getFirstVisibleRow());if(c.isVariableRowHeightEnabled(t)){s.setOffset(1,g.OffsetType.Percentage);}else{s.setOffset(0);}}}).then(function(){return Promise.all([m.scrollViewport(t,p),m.scrollScrollbar(t,p)]);}).then(r);});},performUpdateFromScrollbar:function(t){e("VerticalScrollingHelper.performUpdateFromScrollbar",t);clearTimeout(t._mTimeouts.largeDataScrolling);delete t._mTimeouts.largeDataScrolling;k.start(t,k.UpdateFromScrollbar,function(r,a,p){if(t._bLargeDataScrolling&&!j(t).bIsScrolledVerticallyByWheel){t._mTimeouts.largeDataScrolling=setTimeout(function(){delete t._mTimeouts.largeDataScrolling;if(t._getScrollExtension().getVerticalScrollbar()!=null){e("VerticalScrollingHelper.performUpdateFromScrollbar (async: large data scrolling)",t);m._performUpdateFromScrollbar(t,p).then(r);}else{e("VerticalScrollingHelper.performUpdateFromScrollbar (async: large data scrolling): No scrollbar",t);}},300);p.addCancelListener(function(){if(t._mTimeouts.largeDataScrolling!=null){clearTimeout(t._mAnimationFrames.viewportUpdate);delete t._mAnimationFrames.viewportUpdate;r();}});}else{m._performUpdateFromScrollbar(t,p).then(r);}});},_performUpdateFromScrollbar:function(t,p){return m.adjustScrollPositionToScrollbar(t,p).then(function(){return m.adjustFirstVisibleRowToScrollPosition(t,null,p);}).then(function(){if(c.isVariableRowHeightEnabled(t)){return m.scrollViewport(t,p);}if(p.isCancelled()){return Promise.resolve();}var s=j(t).oVerticalScrollPosition;var i=s.getIndex();var a=t._getMaxFirstRenderedRowIndex();var r=t._aRowHeights;switch(s.getOffsetType()){case g.OffsetType.Percentage:var b=Math.max(0,Math.min(r.length-1,i-a));s.setOffset(r[b]*s.getOffset());break;case g.OffsetType.PercentageOfBuffer:s.setOffset(0);break;default:}return Promise.resolve();});},performUpdateFromViewport:function(t){e("VerticalScrollingHelper.performUpdateFromViewport",t);k.start(t,k.UpdateFromViewport,function(r,a,p){m.adjustScrollPositionToViewport(t,p).then(function(){return m.adjustFirstVisibleRowToScrollPosition(t,true,p);}).then(function(){return m.scrollScrollbar(t,p);}).then(r);});},onScrollbarScroll:function(a){I.notifyScrollEvent&&I.notifyScrollEvent(a);if(!k.canStart(this,k.UpdateFromScrollbar)){return;}if(j(this).bIsScrolledVerticallyByKeyboard){e("VerticalScrollingHelper.onScrollbarScroll: Aborted - Scrolled by keyboard",this);return;}this._getKeyboardExtension().setActionMode(false);var b=a.target.scrollTop;var i=a.target._scrollTop;var s=b!==i;delete a.target._scrollTop;if(b===0&&!f(a.target)){e("VerticalScrollingHelper.onScrollbarScroll: Scrollbar is not connected with the DOM",this);}else if(s){e("VerticalScrollingHelper.onScrollbarScroll: Scroll position changed to "+b+" by interaction",this);m.performUpdateFromScrollbar(this);}else{e("VerticalScrollingHelper.onScrollbarScroll: Scroll position changed to "+b+" by API",this);}j(this).bIsScrolledVerticallyByWheel=false;},onViewportScroll:function(a){if(!k.canStart(this,k.UpdateFromViewport)){return;}var b=a.target.scrollTop;var i=a.target._scrollTop;delete a.target._scrollTop;if(b!==i){e("VerticalScrollingHelper.onViewportScroll: Scroll position changed to "+b+" by interaction",this);m.performUpdateFromViewport(this);}else{e("VerticalScrollingHelper.onViewportScroll: Scroll position changed to "+b+" by API",this);}},adjustFirstVisibleRowToScrollPosition:function(t,s,p){if(p&&p.isCancelled()){return Promise.resolve();}s=s===true;var a=j(t).oVerticalScrollPosition;var N=a.getIndex();var O=t.getFirstVisibleRow();var b=m.isIndexInBuffer(t,N);var i=b;e("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPosition:"+" Set \"firstVisibleRow\" from "+O+" to "+N,t);var r=t.setFirstVisibleRowIndex(N,true,i,s);if(!r){if(b){m.adjustFirstVisibleRowToScrollPositionInBuffer(t,true,s);}return Promise.resolve();}return new Promise(function(u){var v=function(w){e("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPosition (async: rows updated):"+" Reason "+w.getParameters().reason,this);if(b){m.adjustFirstVisibleRowToScrollPositionInBuffer(t,true);}u();return false;};m.addOnRowsUpdatedPreprocessor(t,v);if(p){p.addCancelListener(function(){var R=m.removeOnRowsUpdatedPreprocessor(t,v);if(R){u();}});}});},adjustFirstVisibleRowToScrollPositionInBuffer:function(t,F,s,p){if(p&&p.isCancelled()){return Promise.resolve();}F=F===true;s=s===true;var a=j(t).oVerticalScrollPosition;var i=a.getIndex();if(!m.isIndexInBuffer(t,i)){e("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPositionInBuffer:"+" Aborted - Scroll position is not in buffer",t);return Promise.resolve();}var N=i;var v=m.getScrollRangeOfViewport(t);var b=t._getMaxFirstRenderedRowIndex();var r=t._aRowHeights;var R;e("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPositionInBuffer");if(a.getOffsetType()===g.OffsetType.PercentageOfBuffer){var u=v*a.getOffset();N=b;for(R=0;R<r.length;R++){var w=u-r[R];if(w>=0){u=w;N++;}else{break;}}}else{var x=Math.max(0,Math.min(r.length-1,i-b));var y=0;for(R=0;R<x;R++){y+=r[R];if(y>v){N=b+R;break;}}}if(F){t.setProperty("firstVisibleRow",-1,true);}if(i!==N||F){e("VerticalScrollingHelper.adjustFirstVisibleRowToScrollPositionInBuffer:"+" Set \"firstVisibleRow\" to "+N,t);t.setFirstVisibleRowIndex(N,true,null,s);}return Promise.resolve();},adjustScrollPositionToFirstVisibleRow:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}e("VerticalScrollingHelper.adjustScrollPositionToFirstVisibleRow",t);j(t).oVerticalScrollPosition.setPosition(t.getFirstVisibleRow());return Promise.resolve();},adjustScrollPositionToScrollbar:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=j(t).oVerticalScrollPosition;var a=m.getScrollPositionOfScrollbar(t);var i=m.getScrollRange(t);var b=m.getScrollRangeRowFraction(t);var N=0;var r=0;var u=g.OffsetType.Percentage;var v;e("VerticalScrollingHelper.adjustScrollPositionToScrollbar",t);if(c.isVariableRowHeightEnabled(t)){if(m.isScrollPositionOfScrollbarInBuffer(t)){var B=m.getScrollRangeBuffer(t);var w=i-B;var x=a-w;var y=x/B;N=t._getMaxFirstRenderedRowIndex();if(m.isIndexInBuffer(t,s.getIndex())){var z=m.getScrollRangeOfViewport(t);var A=z*y;var R=t._aRowHeights;for(var C=0;C<R.length;C++){var F=A-R[C];if(F>=0){A=F;N++;}else{r=Math.round(A);u=g.OffsetType.Pixel;break;}}}else{r=y;u=g.OffsetType.PercentageOfBuffer;}}else{v=a/b;N=Math.floor(v);r=v-N;}}else{var G=i-a;var J=G<1;if(J){N=t._getMaxFirstVisibleRowIndex();r=0;u=g.OffsetType.Pixel;}else{v=a/b;N=Math.floor(v);r=v-N;}}s.setPosition(N,r,u);return Promise.resolve();},adjustScrollPositionToViewport:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=j(t).oVerticalScrollPosition;var r=t._aRowHeights;var N=t._iRenderedFirstVisibleRow;var i=0;var a=m.getScrollPositionOfViewport(t);e("VerticalScrollingHelper.adjustScrollPositionToViewport",t);for(var R=0;R<r.length;R++){var b=a-r[R];if(b>=0){a=b;N++;}else{i=Math.round(a);break;}}s.setPosition(N,i);return Promise.resolve();},scrollViewport:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=j(t).oVerticalScrollPosition;var v=t.getDomRef("tableCCnt");var i=m.getScrollRangeOfViewport(t);var r=t._aRowHeights;if(!c.isVariableRowHeightEnabled(t)||!v){e("VerticalScrollingHelper.scrollViewport: Aborted - Guard clause not passed",t);return Promise.resolve();}if(t._getFirstRenderedRowIndex()!==t._iRenderedFirstVisibleRow){e("VerticalScrollingHelper.scrollViewport: Aborted - Rows will be updated",t);return Promise.resolve();}if(i===0){e("VerticalScrollingHelper.scrollViewport: No overflow in viewport - Scroll to 0",t);t.setFirstVisibleRowIndex(0,true);s.setPosition(0);v.scrollTop=0;return Promise.resolve();}var a=s.getIndex();var b=t._getMaxFirstRenderedRowIndex();var u=0;var w=0;var R;e("VerticalScrollingHelper.scrollViewport");switch(s.getOffsetType()){case g.OffsetType.Pixel:case g.OffsetType.Percentage:if(m.isIndexInBuffer(t,a)){var x=0;w=Math.max(0,Math.min(r.length-1,a-b));for(R=0;R<w;R++){x+=r[R];if(x>i){s.setPosition(b+R,i-u);w=R;break;}else{u=x;}}}if(s.isOffsetInPixel()){s.setOffset(Math.min(s.getOffset(),r[w]));}else{s.setOffset(r[w]*s.getOffset());}u+=s.getOffset();if(u>i){s.setOffset(s.getOffset()-(u-i));u=i;}break;case g.OffsetType.PercentageOfBuffer:if(!m.isIndexInBuffer(t,a)){s.setOffset(0);break;}var y=i*s.getOffset();u=Math.round(y);for(R=0;R<r.length;R++){var z=y-r[R];if(z>=0){y=z;w++;}else{s.setPosition(b+w,Math.round(y));break;}}break;default:}e("VerticalScrollingHelper.scrollViewport: Scroll from "+v.scrollTop+" to "+u,t);v.scrollTop=u;v._scrollTop=v.scrollTop;return Promise.resolve();},scrollScrollbar:function(t,p){if(p&&p.isCancelled()){return Promise.resolve();}var s=j(t).oVerticalScrollPosition;var i=s.getIndex();var b=m.getScrollRangeBuffer(t);var a=m.getScrollRange(t);var r=a-b;var u=0;var v=0;var w=m.getScrollRangeOfViewport(t);var R=t._aRowHeights;var x;e("VerticalScrollingHelper.scrollScrollbar",t);if(a===0||R.length===0){e("VerticalScrollingHelper.scrollScrollbar: No scrollable content",t);return Promise.resolve();}switch(s.getOffsetType()){case g.OffsetType.Pixel:case g.OffsetType.Percentage:if(m.isIndexInBuffer(t,i)){var y=0;x=Math.max(0,Math.min(R.length-1,i-t._getMaxFirstRenderedRowIndex()));for(var z=0;z<x;z++){y+=R[z];}if(s.isOffsetInPixel()){y+=Math.min(R[x],s.getOffset());}else{y+=R[x]*s.getOffset();}var A=Math.min(y/w,1);var B=b*A;u=r+B;}else{var C=m.getScrollRangeRowFraction(t);u=i*C;if(s.isOffsetInPixel()){x=Math.max(0,Math.min(R.length-1,i-t._iRenderedFirstVisibleRow));u+=C*Math.min(s.getOffset()/R[x],1);}else{u+=C*s.getOffset();}}break;case g.OffsetType.PercentageOfBuffer:if(m.isIndexInBuffer(t,i)){u=r+Math.round(w*s.getOffset());}break;default:}if(u>0&&u<0.5){v=1;}else if(u>=a-0.5&&u<a){v=a-1;}else{v=Math.round(u);}window.cancelAnimationFrame(t._mAnimationFrames.verticalScrollbarUpdate);delete t._mAnimationFrames.verticalScrollbarUpdate;return new Promise(function(F){t._mAnimationFrames.verticalScrollbarUpdate=window.requestAnimationFrame(function(){var G=t._getScrollExtension().getVerticalScrollbar();delete t._mAnimationFrames.verticalScrollbarUpdate;if(G){e("VerticalScrollingHelper.scrollScrollbar (async): Scroll from "+G.scrollTop+" to "+v,t);G.scrollTop=v;G._scrollTop=G.scrollTop;}else{e("VerticalScrollingHelper.scrollScrollbar (async): Not scrolled - No scrollbar available",t);}F();});if(p){p.addCancelListener(function(){if(t._mAnimationFrames.verticalScrollbarUpdate!=null){window.cancelAnimationFrame(t._mAnimationFrames.verticalScrollbarUpdate);delete t._mAnimationFrames.verticalScrollbarUpdate;F();}});}});},getScrollRange:function(t){var s=t._getScrollExtension();var v=s.getVerticalScrollHeight()-s.getVerticalScrollbarHeight();return Math.max(0,v);},getScrollRangeBuffer:function(t){if(!c.isVariableRowHeightEnabled(t)){return 0;}return V*t._getBaseRowHeight();},getScrollPositionOfScrollbar:function(t){var s=t._getScrollExtension();if(s.isVerticalScrollbarVisible()){return s.getVerticalScrollbar().scrollTop;}else{return 0;}},getScrollPositionOfViewport:function(t){var v=t?t.getDomRef("tableCCnt"):null;return v?v.scrollTop:0;},getScrollRangeRowFraction:function(t){var s=t._getScrollExtension();var v=t._getTotalRowCount()-t._getRowCounts().count;var i;if(c.isVariableRowHeightEnabled(t)){i=m.getScrollRange(t)-m.getScrollRangeBuffer(t);var b=s.getVerticalScrollHeight()===M;if(!b){i+=t._getBaseRowHeight();}}else{i=m.getScrollRange(t);}return i/Math.max(1,v);},isScrollPositionOfScrollbarInBuffer:function(t){if(!c.isVariableRowHeightEnabled(t)){return false;}var s=m.getScrollRange(t);var a=m.getScrollPositionOfScrollbar(t);var i=m.getScrollRangeBuffer(t);return s-a<=i;},isIndexInBuffer:function(t,i){if(!c.isVariableRowHeightEnabled(t)){return false;}return i>=t._getMaxFirstRenderedRowIndex();},getScrollRangeOfViewport:function(t){if(!t||!t._aRowHeights){return 0;}var r=t._aRowHeights;var v=t._getBaseRowHeight()*t._getRowCounts().count;if(t._getRowCounts().count>=t._getTotalRowCount()){r=r.slice(0,t._getTotalRowCount());}var i=r.reduce(function(a,b){return a+b;},0)-v;if(i>0){i=Math.ceil(i);}return Math.max(0,i);},onScrollbarMouseDown:function(a){j(this).bIsScrolledVerticallyByWheel=false;j(this).bIsScrolledVerticallyByKeyboard=false;},addOnRowsUpdatedPreprocessor:function(t,p){j(t).aOnRowsUpdatedPreprocessors.push(p);},removeOnRowsUpdatedPreprocessor:function(t,p){if(!p){j(t).aOnRowsUpdatedPreprocessors=[];return false;}var i=j(t).aOnRowsUpdatedPreprocessors.indexOf(p);if(i>-1){j(t).aOnRowsUpdatedPreprocessors.splice(i,1);return true;}return false;},onRowsUpdated:function(a){e("VerticalScrollingHelper.onRowsUpdated: Reason "+a.getParameters().reason,this);if(j(this).aOnRowsUpdatedPreprocessors.length>0){e("VerticalScrollingHelper.onRowsUpdated (preprocessors)",this);var b=j(this).aOnRowsUpdatedPreprocessors.reduce(function(b,p){var _=p.call(this,a);return!(b&&!_);},true);m.removeOnRowsUpdatedPreprocessor(this);if(!b){e("VerticalScrollingHelper.onRowsUpdated (preprocessors): Default prevented",this);return;}}if(!c.isVariableRowHeightEnabled(this)){e("VerticalScrollingHelper.onRowsUpdated: Aborted - Variable row heights not enabled",this);return;}k.start(this,k.OnRowsUpdated,function(r,i,p){m.scrollViewport(this,p).then(function(){return Promise.all([m.adjustFirstVisibleRowToScrollPosition(this,true,p),m.scrollScrollbar(this,p)]);}.bind(this)).then(r);}.bind(this));},restoreScrollPosition:function(t,b){e("VerticalScrollingHelper.restoreScrollPosition",t);var p=k.start(t,k.RestoreScrollPosition,function(r,a,i){if(b!==true){r(i);return;}var O=function(){e("VerticalScrollingHelper.restoreScrollPosition (async: rows updated)",t);r(i);return false;};m.addOnRowsUpdatedPreprocessor(t,O);i.addCancelListener(function(){var R=m.removeOnRowsUpdatedPreprocessor(t,O);if(R){r(i);}});});if(p){p.then(function(a){if(!a.isCancelled()){m._restoreScrollPosition(t);}});}},_restoreScrollPosition:function(t){var s=j(t).oVerticalScrollPosition;var b=s.isInitial();e("VerticalScrollingHelper.restoreScrollPosition: "+"Scroll position is"+(b?" ":" not ")+"initial",t);if(b){m.performUpdateFromFirstVisibleRow(t);}else{m.performUpdateFromScrollPosition(t);}},adjustToTotalRowCount:function(t){e("VerticalScrollingHelper.adjustToTotalRowCount",t);var s=t._getScrollExtension();s.updateVerticalScrollbarVisibility();s.updateVerticalScrollHeight();var p=k.start(t,k.AdjustToTotalRowCount,function(r,a,b){if(j(t).oVerticalScrollPosition.isInitial()){r(b);}else{var O=function(){e("VerticalScrollingHelper.adjustToTotalRowCount (async: rows updated)",t);r(b);return false;};m.addOnRowsUpdatedPreprocessor(t,O);b.addCancelListener(function(){var R=m.removeOnRowsUpdatedPreprocessor(t,O);if(R){r(b);}});}});if(p){p.then(function(a){if(a.isCancelled()||j(t).oVerticalScrollPosition.isInitial()){return;}m.scrollViewport(t);m.performUpdateFromScrollPosition(t);});}},addEventListeners:function(t){var s=t._getScrollExtension();var a=m.getScrollAreas(t);var v=s.getVerticalScrollbar();var b=t.getDomRef("tableCCnt");if(!s._onVerticalScrollEventHandler){s._onVerticalScrollEventHandler=m.onScrollbarScroll.bind(t);}for(var i=0;i<a.length;i++){a[i].addEventListener("scroll",s._onVerticalScrollEventHandler);}if(v){if(!s._onVerticalScrollbarMouseDownEventHandler){s._onVerticalScrollbarMouseDownEventHandler=m.onScrollbarMouseDown.bind(t);}v.addEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);}if(b){if(!s._onViewportScrollEventHandler){s._onViewportScrollEventHandler=m.onViewportScroll.bind(t);}b.addEventListener("scroll",s._onViewportScrollEventHandler);}t.attachEvent("_rowsUpdated",m.onRowsUpdated);},removeEventListeners:function(t){var s=t._getScrollExtension();var a=m.getScrollAreas(t);var v=s.getVerticalScrollbar();var b=t.getDomRef("tableCCnt");if(s._onVerticalScrollEventHandler){for(var i=0;i<a.length;i++){a[i].removeEventListener("scroll",s._onVerticalScrollEventHandler);}delete s._onVerticalScrollEventHandler;}if(v&&s._onVerticalScrollbarMouseDownEventHandler){v.removeEventListener("mousedown",s._onVerticalScrollbarMouseDownEventHandler);delete s._onVerticalScrollbarMouseDownEventHandler;}if(b&&s._onViewportScrollEventHandler){b.removeEventListener("scroll",s._onViewportScrollEventHandler);delete s._onViewportScrollEventHandler;}t.detachEvent("_rowsUpdated",m.onRowsUpdated);},getScrollAreas:function(t){var s=[t._getScrollExtension().getVerticalScrollbar()];return s.filter(function(a){return a!=null;});}};var n={onMouseWheelScrolling:function(O,a){var s=this._getScrollExtension();var v=Math.abs(a.deltaY)>Math.abs(a.deltaX);var i=v?a.deltaY:a.deltaX;var b=v&&a.shiftKey||!v;var p=i>0;var r=false;if(i===0){return;}if(b&&(O.scrollDirection===d.HORIZONAL||O.scrollDirection===d.BOTH)){var t=s.getHorizontalScrollbar();if(a.deltaMode!==window.WheelEvent.DOM_DELTA_PIXEL){var u=c.Column.getMinColumnWidth();i=p?u:-u;}if(p){r=t.scrollLeft===t.scrollWidth-t.offsetWidth;}else{r=t.scrollLeft===0;}if(s.isHorizontalScrollbarVisible()&&!r){a.preventDefault();a.stopPropagation();this._getKeyboardExtension().setActionMode(false);t.scrollLeft=t.scrollLeft+i;}}else if(!b&&(O.scrollDirection===d.VERTICAL||O.scrollDirection===d.BOTH)){var w=s.getVerticalScrollbar();var x=j(this).oVerticalScrollPosition;if(p){r=w.scrollTop===w.scrollHeight-w.offsetHeight;}else{r=w.scrollTop===0;}if(!s.isVerticalScrollbarVisible()||r){return;}a.preventDefault();a.stopPropagation();if(a.deltaMode===window.WheelEvent.DOM_DELTA_PIXEL){var y=i/this._getDefaultRowHeight();if(y>=0){x.scrollRows(Math.max(1,Math.floor(y)));}else{x.scrollRows(Math.min(-1,Math.ceil(y)));}}else if(a.deltaMode===window.WheelEvent.DOM_DELTA_LINE){x.scrollRows(i);}else if(a.deltaMode===window.WheelEvent.DOM_DELTA_PAGE){x.scrollRows(i*this._getRowCounts().count);}j(this).bIsScrolledVerticallyByWheel=true;j(this).bIsScrolledVerticallyByKeyboard=false;this._getKeyboardExtension().setActionMode(false);m.performUpdateFromScrollPosition(this);}},onTouchStart:function(O,a){if(a.type==="touchstart"||a.pointerType==="touch"){var s=this._getScrollExtension();var b=s.getHorizontalScrollbar();var v=s.getVerticalScrollbar();var t=a.touches?a.touches[0]:a;j(this).mTouchSessionData={initialPageX:t.pageX,initialPageY:t.pageY,initialScrollTop:v?v.scrollTop:0,initialScrollLeft:b?b.scrollLeft:0,initialScrolledToEnd:null,touchMoveDirection:null};}},onTouchMoveScrolling:function(O,a){if(a.type!=="touchmove"&&a.pointerType!=="touch"){return;}var s=this._getScrollExtension();var t=j(this).mTouchSessionData;if(!t){return;}var b=a.touches?a.touches[0]:a;var i=(b.pageX-t.initialPageX);var p=(b.pageY-t.initialPageY);var r=false;if(!t.touchMoveDirection){if(i===0&&p===0){return;}t.touchMoveDirection=Math.abs(i)>Math.abs(p)?"horizontal":"vertical";}switch(t.touchMoveDirection){case"horizontal":var u=s.getHorizontalScrollbar();if(u&&(O.scrollDirection===d.HORIZONAL||O.scrollDirection===d.BOTH)){this._getKeyboardExtension().setActionMode(false);if(t.initialScrolledToEnd==null){if(i<0){t.initialScrolledToEnd=u.scrollLeft===u.scrollWidth-u.offsetWidth;}else{t.initialScrolledToEnd=u.scrollLeft===0;}}if(!t.initialScrolledToEnd){u.scrollLeft=t.initialScrollLeft-i;r=true;}}break;case"vertical":var v=s.getVerticalScrollbar();if(v&&(O.scrollDirection===d.VERTICAL||O.scrollDirection===d.BOTH)){this._getKeyboardExtension().setActionMode(false);if(t.initialScrolledToEnd==null){if(p<0){t.initialScrolledToEnd=v.scrollTop===v.scrollHeight-v.offsetHeight;}else{t.initialScrolledToEnd=v.scrollTop===0;}}if(!t.initialScrolledToEnd){v.scrollTop=t.initialScrollTop-p;r=true;}}break;default:}if(r){a.preventDefault();}},addEventListeners:function(t){var s=t._getScrollExtension();var a=n.getEventListenerTargets(t);s._mMouseWheelEventListener=this.addMouseWheelEventListener(a,t,{scrollDirection:d.BOTH});s._mTouchEventListener=this.addTouchEventListener(a,t,{scrollDirection:d.BOTH});},addMouseWheelEventListener:function(a,t,O){var b=n.onMouseWheelScrolling.bind(t,O);for(var i=0;i<a.length;i++){a[i].addEventListener("wheel",b);}return{wheel:b};},addTouchEventListener:function(a,t,O){var b=n.onTouchStart.bind(t,O);var p=n.onTouchMoveScrolling.bind(t,O);var r={};for(var i=0;i<a.length;i++){if(D.support.pointer&&D.system.desktop){a[i].addEventListener("pointerdown",b);a[i].addEventListener("pointermove",p,D.browser.chrome?{passive:true}:false);}else if(D.support.touch){a[i].addEventListener("touchstart",b);a[i].addEventListener("touchmove",p);}}if(D.support.pointer&&D.system.desktop){r={pointerdown:b,pointermove:p};}else if(D.support.touch){r={touchstart:b,touchmove:p};}return r;},removeEventListeners:function(t){var s=t._getScrollExtension();var a=n.getEventListenerTargets(t);function r(b,p){for(var u in p){var v=p[u];if(v){b.removeEventListener(u,v);}}}for(var i=0;i<a.length;i++){r(a[i],s._mMouseWheelEventListener);r(a[i],s._mTouchEventListener);}delete s._mMouseWheelEventListener;delete s._mTouchEventListener;},getEventListenerTargets:function(t){var a=[t.getDomRef("tableCCnt")];return a.filter(function(b){return b!=null;});}};var E={onBeforeRendering:function(a){this._getScrollExtension()._clearCache();},onAfterRendering:function(a){var s=this._getScrollExtension();var r=a!=null&&a.isMarked("renderRows");if(r){s.updateVerticalScrollbarHeight();s.updateVerticalScrollHeight();}else{m.restoreScrollPosition(this,true);}H.restoreScrollPosition(this);},onfocusin:function(a){var r;var C=c.getCellInfo(a.target);var b=this._getScrollExtension().getHorizontalScrollbar();if(C.isOfType(c.CELLTYPE.DATACELL)){r=this.getDomRef("sapUiTableCtrlScr");}else if(C.isOfType(c.CELLTYPE.COLUMNHEADER)){r=this.getDomRef("sapUiTableColHdrScr");}if(r&&b&&C.columnIndex>=this.getComputedFixedColumnCount()){var $=q(b);var i=C.cell[0];var p=this._bRtlMode?$.scrollLeftRTL():b.scrollLeft;var R=r.clientWidth;var s=i.offsetLeft;var t=s+i.offsetWidth;var O=s-p;var u=t-R-p;var N;if(O<0&&u<0){N=p+O;}else if(u>0&&O>0){N=p+u;}if(N!=null){if(this._bRtlMode){$.scrollLeftRTL(N);}else{b.scrollLeft=N;}}}var v=c.getParentCell(this,a.target);if(v){var w=this;var x=function(){var y=v.find(".sapUiTableCellInner");if(y.length>0){if(w._bRtlMode){y.scrollLeftRTL(y[0].scrollWidth-y[0].clientWidth);}else{y[0].scrollLeft=0;}y[0].scrollTop=0;}};Promise.resolve().then(function(){if(D.browser.safari){window.setTimeout(x,0);}else{x();}});}}};var o=T.extend("sap.ui.table.TableScrollExtension",{_init:function(t,s,a){this._delegate=E;c.addDelegate(t,this._delegate,t);return"ScrollExtension";},_attachEvents:function(){var t=this.getTable();H.addEventListeners(t);m.addEventListeners(t);n.addEventListeners(t);},_detachEvents:function(){var t=this.getTable();H.removeEventListeners(t);m.removeEventListeners(t);n.removeEventListeners(t);},destroy:function(){var t=this.getTable();c.removeDelegate(t,this._delegate);this._delegate=null;this._clearCache();j.destroy(t);T.prototype.destroy.apply(this,arguments);}});o.prototype.scrollVertically=function(b,p,i,a,B){var t=this.getTable();if(!t){return false;}b=b===true;p=p===true;i=i===true;a=a===true;var s=false;var r=t._getTotalRowCount();var R=t._getRowCounts();var F=t.getFirstVisibleRow();var u=p?R.scrollable:1;if(b){if(F+R.count<r){if(B){B();}if(a){setTimeout(function(){t.setFirstVisibleRow(Math.min(F+u,r-R.count));},0);}else{t.setFirstVisibleRow(Math.min(F+u,r-R.count));}s=true;}}else if(F>0){if(B){B();}if(a){setTimeout(function(){t.setFirstVisibleRow(Math.max(F-u,0));},0);}else{t.setFirstVisibleRow(Math.max(F-u,0));}s=true;}if(s&&i){j(t).bIsScrolledVerticallyByKeyboard=true;}return s;};o.prototype.scrollVerticallyMax=function(b,i){var t=this.getTable();if(!t){return false;}if(b==null){b=false;}if(i==null){i=false;}var s=false;var F=t.getFirstVisibleRow();if(b){var a=t._getTotalRowCount()-c.getNonEmptyVisibleRowCount(t);if(F<a){t.setFirstVisibleRow(a);s=true;}}else if(F>0){t.setFirstVisibleRow(0);s=true;}if(s&&i){j(t).bIsScrolledVerticallyByKeyboard=true;}return s;};o.prototype.getHorizontalScrollbar=function(){var t=this.getTable();if(t&&!t._bInvalid&&!j(t).oHorizontalScrollbar){j(t).oHorizontalScrollbar=t.getDomRef(S.HorizontalScrollBar);}return j(t).oHorizontalScrollbar||null;};o.prototype.getVerticalScrollbar=function(i){var t=this.getTable();var b=this.isVerticalScrollbarExternal();if(t&&!t._bInvalid&&!j(t).oVerticalScrollbar){j(t).oVerticalScrollbar=t.getDomRef(S.VerticalScrollBar);if(!j(t).oVerticalScrollbar&&b){j(t).oVerticalScrollbar=j(t).oExternalVerticalScrollbar;}}var s=j(t).oVerticalScrollbar;if(s&&!b&&!i&&!f(s)){return null;}return s||null;};o.prototype.isHorizontalScrollbarVisible=function(){var a=this.getHorizontalScrollbar();return a!=null&&!a.classList.contains("sapUiTableHidden");};o.prototype.isVerticalScrollbarVisible=function(){var v=this.getVerticalScrollbar();return v!=null&&!v.classList.contains("sapUiTableHidden");};o.prototype.isVerticalScrollbarExternal=function(){return j(this.getTable()).bIsVerticalScrollbarExternal;};o.prototype.markVerticalScrollbarAsExternal=function(s){if(s){j(this.getTable()).bIsVerticalScrollbarExternal=true;j(this.getTable()).oExternalVerticalScrollbar=s;}};o.prototype.updateHorizontalScrollbar=function(t){var a=this.getTable();var b=this.getHorizontalScrollbar();if(!a||!b||!t){return;}var $=a.$();var C=t.tableCtrlScrollWidth;if(D.browser.safari){C=Math.max(C,a._getColumnsWidth(a.getComputedFixedColumnCount()));}var i=C>t.tableCtrlScrWidth;if(i){if(!this.isHorizontalScrollbarVisible()){$.addClass("sapUiTableHScr");b.classList.remove("sapUiTableHidden");if(D.browser.safari){var p=$.find(".sapUiTableCtrlScroll, .sapUiTableColHdrScr > .sapUiTableColHdr");p.outerWidth(C);}}var s=t.tableCtrlFixedWidth;if($.find(".sapUiTableRowHdrScr").length>0){s+=t.tableRowHdrScrWidth;}if(a._bRtlMode){b.style.marginRight=s+"px";b.style.marginLeft="";}else{b.style.marginLeft=s+"px";b.style.marginRight="";}var r=a.getDomRef("hsb-content");if(r){r.style.width=C+"px";}}if(!i&&this.isHorizontalScrollbarVisible()){$.removeClass("sapUiTableHScr");b.classList.add("sapUiTableHidden");if(D.browser.safari){$.find(".sapUiTableCtrlScroll, .sapUiTableColHdr").css("width","");}}};o.prototype.updateVerticalScrollbarHeight=function(){var t=this.getTable();var v=this.getVerticalScrollbar();if(!t||!v){return;}v.style.maxHeight=this.getVerticalScrollbarHeight()+"px";v._scrollTop=v.scrollTop;};o.prototype.getVerticalScrollbarHeight=function(){var t=this.getTable();if(!t){return 0;}return t._getRowCounts().scrollable*t._getBaseRowHeight();};o.prototype.updateVerticalScrollbarPosition=function(){var t=this.getTable();var v=this.getVerticalScrollbar();if(!t||!v){return;}var a=t.getDomRef("tableCCnt");if(a){var i=a.offsetTop;var b=t.getDomRef("vsb-bg");if(b){b.style.top=i+"px";}if(t._getRowCounts().fixedTop>0){i+=t._iVsbTop;}v.style.top=i+"px";}};o.prototype.updateVerticalScrollPosition=function(b){var t=this.getTable();if(!t){return;}m.performUpdateFromFirstVisibleRow(t,b);};o.prototype.adjustToTotalRowCount=function(){m.adjustToTotalRowCount(this.getTable());};o.prototype.restoreVerticalScrollPosition=function(){m.restoreScrollPosition(this.getTable());};o.prototype.updateVerticalScrollHeight=function(){var v=this.getVerticalScrollbar();var a=v?v.firstChild:null;if(!a){return;}a.style.height=this.getVerticalScrollHeight()+"px";v._scrollTop=v.scrollTop;};o.prototype.getVerticalScrollHeight=function(b){var t=this.getTable();if(!t){return 0;}var i=t._getTotalRowCount();var v=t._getRowCounts().count;var B=t._getBaseRowHeight();var r;var s;if(c.isVariableRowHeightEnabled(t)){r=Math.max(i,v+1);s=B*(r-1)+m.getScrollRangeBuffer(t);}else{r=Math.max(i,v);s=B*r;}if(b===true){return s;}else{return Math.min(M,s);}};o.prototype.updateVerticalScrollbarVisibility=function(){var t=this.getTable();var a=t?t.getDomRef():null;var v=this.getVerticalScrollbar();if(!a||!v){return;}var b=this.isVerticalScrollbarRequired();if(b&&!this.isVerticalScrollbarVisible()){if(!this.isVerticalScrollbarExternal()){a.classList.add("sapUiTableVScr");}v.classList.remove("sapUiTableHidden");}if(!b&&this.isVerticalScrollbarVisible()){a.classList.remove("sapUiTableVScr");v.classList.add("sapUiTableHidden");}};o.prototype.isVerticalScrollbarRequired=function(){var t=this.getTable();if(!t){return false;}return c.isVariableRowHeightEnabled(t)&&m.getScrollRangeOfViewport(t)>0||t._getTotalRowCount()>t._getRowCounts().count;};o.prototype.registerForMouseWheel=function(a,O){var t=this.getTable();if(T.isEnrichedWith(t,"sap.ui.table.TableSyncExtension")){return n.addMouseWheelEventListener(a,t,O);}else{L.error("This method can only be used with synchronization enabled.",t,"TableScrollExtension#registerForMouseWheel");return null;}};o.prototype.registerForTouch=function(a,O){var t=this.getTable();if(T.isEnrichedWith(t,"sap.ui.table.TableSyncExtension")){return n.addTouchEventListener(a,t,O);}else{L.error("This method can only be used with synchronization enabled.",t,"TableScrollExtension#registerForTouch");return null;}};o.prototype._clearCache=function(){j(this.getTable()).oVerticalScrollbar=null;j(this.getTable()).oHorizontalScrollbar=null;};o.ScrollDirection=d;return o;});
