/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/apply/_internal/connectors/Utils","sap/ui/fl/write/_internal/connectors/Utils","sap/ui/fl/write/_internal/StorageFeaturesMerger","sap/base/util/ObjectPath"],function(A,W,S,O){"use strict";function f(l,c){var F=c.filter(function(C){return C.layers.indexOf("ALL")!==-1||C.layers.indexOf(l)!==-1;});if(F.length===1){return F[0];}if(F.length===0){throw new Error("No Connector configuration could be found to write into layer: "+l);}if(F.length>1){throw new Error("sap.ui.core.Configuration 'flexibilityServices' has a misconfiguration: Multiple Connector configurations were found to write into layer: "+l);}}function s(c){var C=c.map(function(o){return o.writeConnectorModule.loadFeatures({url:o.url}).catch(A.logAndResolveDefault.bind(null,{},o,"loadFeatures"));});return Promise.all(C);}function g(l){if(!l){return Promise.reject("No layer was provided");}return W.getWriteConnectors().then(f.bind(this,l));}function e(b,p){return g(p.layer).then(function(c){p.url=c.url;var C=O.get(b,c.writeConnectorModule);return C.call(c.writeConnectorModule,p);});}var a={};a.write=function(p){return e("write",p);};a.remove=function(p){return e("remove",p);};a.update=function(p){return e("update",p);};a.reset=function(p){return e("reset",p);};a.getFlexInfo=function(p){return e("getFlexInfo",p);};a.loadFeatures=function(){return W.getWriteConnectors().then(s).then(S.mergeResults);};a.appVariant={getManifest:function(p){return e("appVariant.getManifest",p);},create:function(p){return e("appVariant.create",p);},load:function(p){return e("appVariant.load",p);},update:function(p){return e("appVariant.update",p);},remove:function(p){return e("appVariant.remove",p);},list:function(p){return e("appVariant.list",p);},assignCatalogs:function(p){return e("appVariant.assignCatalogs",p);},unassignCatalogs:function(p){return e("appVariant.unassignCatalogs",p);}};return a;},true);
