/*
 * ! OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["sap/ui/fl/write/ChangesController","sap/ui/fl/Cache","sap/ui/fl/Utils","sap/ui/core/util/reflection/JsControlTreeModifier","sap/ui/fl/descriptorRelated/api/DescriptorInlineChangeFactory","sap/base/util/includes"],function(C,a,U,J,D,i){"use strict";var P={NOTAG:a.NOTAG,getCacheKey:function(A){var c={name:U.getComponentName(A),appVersion:U.getAppVersionFromManifest(A.getManifest())};return a.getCacheKey(c,A);},hasHigherLayerChanges:function(m,p){return C.getFlexControllerInstance(m).hasHigherLayerChanges(p);},saveChanges:function(s,m){var f=C.getFlexControllerInstance(m);var d=C.getDescriptorFlexControllerInstance(m);return f.saveAll(s).then(d.saveAll.bind(d));},resetChanges:function(l,g,c,s,b){var f=C.getFlexControllerInstance(c);var d=C.getDescriptorFlexControllerInstance(c);return f.resetChanges(l,g,c,s,b).then(d.resetChanges.bind(d,l,g,c,s,b));},_transportChanges:function(r,s,l,A){return C.getFlexControllerInstance(r)._oChangePersistence.transportAllUIChanges(r,s,l,A);},add:function(c,m){if(i(D.getDescriptorChangeTypes(),c.getChangeType())){return c.store();}var A=U.getAppComponentForControl(m);return C.getFlexControllerInstance(A).addPreparedChange(c,A);},remove:function(c,p){if(i(D.getDescriptorChangeTypes(),c.getChangeType())){var d=C.getDescriptorFlexControllerInstance(p.appComponent);d.deleteChange(c,p.appComponent);return Promise.resolve();}var f=C.getFlexControllerInstance(p.appComponent);if(p.revert){return f.revertChangesOnControl([c],p.appComponent);}var o=J.bySelector(c.getSelector(),p.appComponent);return f.removeFromAppliedChangesOnControl(c,p.appComponent,o).then(f.deleteChange.bind(f,c,p.appComponent));},getUIChanges:function(p){return C.getFlexControllerInstance(p.managedObject).getComponentChanges(p,p.invalidateCache);},getDirtyChanges:function(m){return C.getFlexControllerInstance(m)._oChangePersistence.getDirtyChanges();}};return P;},true);
