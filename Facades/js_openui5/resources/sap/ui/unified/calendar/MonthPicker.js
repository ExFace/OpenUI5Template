/*!
 * OpenUI5
 * (c) Copyright 2009-2019 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(['sap/ui/core/Control','sap/ui/Device','sap/ui/core/LocaleData','sap/ui/core/delegate/ItemNavigation','sap/ui/unified/library','sap/ui/core/Locale',"./MonthPickerRenderer","sap/ui/thirdparty/jquery","sap/ui/events/KeyCodes"],function(C,D,L,I,l,a,M,q,K){"use strict";var c=12,O={OneYearBackward:-1,OneYearForward:1};var d=C.extend("sap.ui.unified.calendar.MonthPicker",{metadata:{library:"sap.ui.unified",properties:{month:{type:"int",group:"Data",defaultValue:0},months:{type:"int",group:"Appearance",defaultValue:12},columns:{type:"int",group:"Appearance",defaultValue:3},primaryCalendarType:{type:"sap.ui.core.CalendarType",group:"Appearance"}},events:{select:{},pageChange:{}}}});d.prototype.init=function(){var s=sap.ui.getCore().getConfiguration().getCalendarType();this.setProperty("primaryCalendarType",s);this._iMinMonth=0;this._iMaxMonth=11;};d.prototype.onAfterRendering=function(){_.call(this);k.call(this);};d.prototype.setMonth=function(i){this.setProperty("month",i,true);i=this.getProperty("month");if(i<0||i>11){throw new Error("Property month must be between 0 and 11; "+this);}if(this.getDomRef()){if(this.getMonths()<12){var s=this.getStartMonth();if(i>=s&&i<=s+this.getMonths()-1){j.call(this,i,true);this._oItemNavigation.focusItem(i-s);}else{m.call(this,i);}}else{j.call(this,i,true);this._oItemNavigation.focusItem(i);}}return this;};d.prototype._getLocale=function(){var p=this.getParent();if(p&&p._getLocale){return p._getLocale();}else if(!this._sLocale){this._sLocale=sap.ui.getCore().getConfiguration().getFormatSettings().getFormatLocale().toString();}return this._sLocale;};d.prototype._getLocaleData=function(){var p=this.getParent();if(p&&p._getLocaleData){return p._getLocaleData();}else if(!this._oLocaleData){var s=this._getLocale();var o=new a(s);this._oLocaleData=L.getInstance(o);}return this._oLocaleData;};d.prototype.onsapspace=function(E){E.preventDefault();};d.prototype.onsapselect=function(E){var i=this._oItemNavigation.getFocusedIndex();var b=i+this.getStartMonth();if(b>=this._iMinMonth&&b<=this._iMaxMonth){j.call(this,b);this.fireSelect();}};d.prototype.onmousedown=function(E){this._oMousedownPosition={clientX:E.clientX,clientY:E.clientY};};d.prototype.onmouseup=function(E){if(this._bMousedownChange){this._bMousedownChange=false;this.fireSelect();}else if(D.support.touch&&this._isValueInThreshold(this._oMousedownPosition.clientX,E.clientX,10)&&this._isValueInThreshold(this._oMousedownPosition.clientY,E.clientY,10)){var i=this._oItemNavigation.getFocusedIndex();var b=i+this.getStartMonth();j.call(this,b);this.fireSelect();}};d.prototype.onThemeChanged=function(){if(this._bNoThemeChange){return;}if(!this.getDomRef()){return;}var b=this._oItemNavigation.getItemDomRefs(),o=this._getLocaleData(),n=o.getMonthsStandAlone("wide",this.getPrimaryCalendarType()),i,$;this._bNamesLengthChecked=undefined;this._bLongMonth=false;for(i=0;i<b.length;i++){$=q(b[i]);$.text(n[i]);}k.call(this);};d.prototype.nextPage=function(){var s=this.getStartMonth(),i=this._oItemNavigation.getFocusedIndex(),b=i+s,n=this.getMonths();b=b+n;if(b>c-1){b=c-1;}m.call(this,b);return this;};d.prototype.previousPage=function(){var s=this.getStartMonth(),i=this._oItemNavigation.getFocusedIndex(),b=i+s,n=this.getMonths();b=b-n;if(b<0){b=0;}m.call(this,b);return this;};d.prototype.setMinMax=function(b,n){if(b==this._iMinMonth&&n==this._iMaxMonth){return this;}b=parseInt(b);if(isNaN(b)||b<0||b>11){b=0;}n=parseInt(n);if(isNaN(n)||n<0||n>11){n=11;}if(b<=n){this._iMinMonth=b;this._iMaxMonth=n;}else{this._iMaxMonth=b;this._iMinMonth=n;}if(this.getDomRef()){var o=this._oItemNavigation.getItemDomRefs();var p=this.getId().length+2;for(var i=0;i<o.length;i++){var $=q(o[i]);var r=parseInt($.attr("id").slice(p));if(r<this._iMinMonth||r>this._iMaxMonth){$.addClass("sapUiCalItemDsbl");$.attr("aria-disabled",true);}else{$.removeClass("sapUiCalItemDsbl");$.removeAttr("aria-disabled");}}}return this;};d.prototype.getStartMonth=function(){if(this.getMonths()<c){var F=this._oItemNavigation.getItemDomRefs()[0];return parseInt(F.id.slice(this.getId().length+2));}else{return 0;}};d.prototype._isValueInThreshold=function(r,v,t){var i=r-t,u=r+t;return v>=i&&v<=u;};d.prototype.ontouchstart=function(E){if(!D.system.desktop&&E.target.classList.contains("sapUiCalItem")){E.target.classList.add("sapUiCalItemSel");}};function _(){var r=this.getDomRef(),b=this.$().find(".sapUiCalItem"),i=this.getColumns();if(!this._oItemNavigation){this._oItemNavigation=new I();this._oItemNavigation.attachEvent(I.Events.AfterFocus,e,this);this._oItemNavigation.attachEvent(I.Events.FocusAgain,f,this);this._oItemNavigation.attachEvent(I.Events.BorderReached,h,this);this.addDelegate(this._oItemNavigation);this._oItemNavigation.setHomeEndColumnMode(true,true);this._oItemNavigation.setDisabledModifiers({sapnext:["alt","meta"],sapprevious:["alt","meta"],saphome:["alt","meta"],sapend:["meta"]});}this._oItemNavigation.setRootDomRef(r);this._oItemNavigation.setItemDomRefs(b);this._oItemNavigation.setCycling(false);this._oItemNavigation.setColumns(i,true);var n=this.getMonth()-this.getStartMonth();this._oItemNavigation.setFocusedIndex(n);this._oItemNavigation.setPageSize(b.length);}function e(o){var i=o.getParameter("index"),E=o.getParameter("event");if(!E){return;}if(E.type=="mousedown"){g.call(this,E,i);}}function f(o){var i=o.getParameter("index");var E=o.getParameter("event");if(!E){return;}if(E.type=="mousedown"){g.call(this,E,i);}}function g(E,i){if(E.button||D.support.touch){return;}var b=i+this.getStartMonth();if(b>=this._iMinMonth&&b<=this._iMaxMonth){j.call(this,b);this._bMousedownChange=true;}E.preventDefault();E.setMark("cancelAutoClose");}function h(o){var E=o.getParameter("event");if(E.type){var i=this._oItemNavigation.getFocusedIndex()+this.getStartMonth(),b=this.getMonths(),n=this.getColumns();switch(E.type){case"sapnext":case"sapnextmodifiers":if(E.keyCode===K.ARROW_DOWN&&n<=b){if(i<c-b){m.call(this,i+n,false,O.OneYearForward);}else if(b===c){this.firePageChange({offset:O.OneYearForward});this._oItemNavigation.focusItem(i%n);}else{m.call(this,i%n,true,O.OneYearForward);}}else{if(i<c-b){m.call(this,i+1,false,O.OneYearForward);}else if(b===c){this.firePageChange({offset:O.OneYearForward});this._oItemNavigation.focusItem(0);}else{m.call(this,0,true,O.OneYearForward);}}break;case"sapprevious":case"sappreviousmodifiers":if(E.keyCode===K.ARROW_UP&&n<=b){if(i>=b){m.call(this,i-n,false,O.OneYearBackward);}else if(b===c){this.firePageChange({offset:O.OneYearBackward});this._oItemNavigation.focusItem(b-n+i);}else{m.call(this,c-n+i,true,O.OneYearBackward);}}else{if(i>=b){m.call(this,i-1,false,O.OneYearBackward);}else if(b===c){this.firePageChange({offset:O.OneYearBackward});this._oItemNavigation.focusItem(b-1);}else{m.call(this,c-1,true,O.OneYearBackward);}}break;case"sappagedown":if(i<c-b){m.call(this,i+b,false,O.OneYearForward);}else if(b===c){this.firePageChange({offset:O.OneYearForward});}else{m.call(this,i,true,O.OneYearForward);}break;case"sappageup":if(i>b){m.call(this,i-b,false,O.OneYearBackward);}else if(b===c){this.firePageChange({offset:O.OneYearBackward});}else{m.call(this,i,true,O.OneYearBackward);}break;default:break;}}}function j(b,n){var o=this._oItemNavigation.getItemDomRefs(),$,s=this.getId()+"-m"+b,i;for(i=0;i<o.length;i++){$=q(o[i]);if($.attr("id")==s){$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");}else{$.removeClass("sapUiCalItemSel");$.attr("aria-selected","false");}}if(!n){this.setProperty("month",b,true);}}function k(){if(!this._bNamesLengthChecked){var i=0,n=this._oItemNavigation.getItemDomRefs(),t=false,o=this.getMonths(),B=Math.ceil(c/o),p=o-1;for(var b=0;b<B;b++){if(o<c){m.call(this,p);p=p+o;if(p>c-1){p=c-1;}}for(i=0;i<n.length;i++){var r=n[i];if(Math.abs(r.clientWidth-r.scrollWidth)>1){t=true;break;}}if(t){break;}}if(o<c){p=this.getMonth();m.call(this,p);}if(t){this._bLongMonth=false;var s=this._getLocaleData(),u=this.getPrimaryCalendarType(),v=s.getMonthsStandAlone("abbreviated",u),w=s.getMonthsStandAlone("wide",u);for(i=0;i<n.length;i++){var $=q(n[i]);$.text(v[i]);$.attr("aria-label",w[i]);}}else{this._bLongMonth=true;}this._bNamesLengthChecked=true;}}function m(b,F,o){var n=this._oItemNavigation.getItemDomRefs(),p=n.length,s=Math.floor(b/p)*p;if(s+p>c){s=c-p;}var r=this._getLocaleData(),t=[],u=[],v=this.getPrimaryCalendarType();if(this._bLongMonth||!this._bNamesLengthChecked){t=r.getMonthsStandAlone("wide",v);}else{t=r.getMonthsStandAlone("abbreviated",v);u=r.getMonthsStandAlone("wide",v);}for(var i=0;i<n.length;i++){var w=i+s,$=q(n[i]);$.text(t[i+s]);$.attr("id",this.getId()+"-m"+(i+s));if(!this._bLongMonth){$.attr("aria-label",u[i+s]);}if(w===this.getMonth()){$.addClass("sapUiCalItemSel");$.attr("aria-selected","true");}else{$.removeClass("sapUiCalItemSel");$.attr("aria-selected","false");}if(w<this._iMinMonth||w>this._iMaxMonth){$.addClass("sapUiCalItemDsbl");$.attr("aria-disabled",true);}else{$.removeClass("sapUiCalItemDsbl");$.removeAttr("aria-disabled");}}this._oItemNavigation.focusItem(b-s);if(F){this.firePageChange({offset:o});}}return d;});
